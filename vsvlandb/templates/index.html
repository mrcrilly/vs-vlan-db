{% extends "base.html" %}
{% block title %}VS VLAN DB - Dashboard{% endblock %}
{% block content %}
<div class="row">
	<div class="col-lg-6">
        <h2 class="text-center">VLANs</h2>
        <div id="vlans"></div>
        <div class="panel panel-default">
          <div class="panel-heading">
          {% if vlans.all()|count >= 1 %}
              <h4 class="panel-title">20 Latest VLANs</h4>
          {% else %}
              <h4 class="panel-title">No VLANs available</h4>
         {% endif %}
          </div>
          <table class="table table-striped table-hover">
              <thead>
                  <tr>
                      <th>VLAN</th>
                      <th>Subnets</th>
                      <th>Sites</th>
                      <th>Enhanced</th>
                      <th>Impact</th>
                  </tr>
              </thead>
              <tbody>
              {% if vlans.all()|count >= 1 %}
                  {% for vlan in vlans.filter_by(isactive=True).all()[:20] %}
                  <tr>
                      <td><a href="/vlans/view/{{vlan.id}}">{{vlan.vlan}}</a></td>
                      <td>{{vlan.subnets|count}}</td>
                      <td>{{vlan.sites|count}}</td>
                      <td>{{vlan.enhanced}}</td>
                      <td>{{vlan.impact.name}}</td>
                  </tr>
                  {% endfor %}
              {% else %}
                  <tr>
                      <td>N/D</td>
                      <td>N/D</td>
                      <td>N/D</td>
                      <td>N/D</td>
                      <td>N/D</td>
                  </tr>
              {% endif %}
              </tbody>
          </table>
        </div>
	</div>
    <div class="col-lg-6">
        <h2 class="text-center">Subnets</h2>
        <div id="subnets"></div>
        <div class="panel panel-default">
          <div class="panel-heading">
          {% if subnets.all()|count >= 1 %}
              <h4 class="panel-title">20 Latest Subnets</h4>
          {% else %}
              <h4 class="panel-title">No subnets available</h4>
         {% endif %}
          </div>
          <table class="table table-striped table-hover">
              <thead>
                  <tr>
                      <th>Subnet</th>
                      <th>VLANs</th>
                      <th>Sites</th>
                  </tr>
              </thead>
              <tbody>
              {% if subnets.all()|count >= 1 %}
                  {% for subnet in subnets.filter_by(isactive=True).all()[:20] %}
                  <tr>
                      <td><a href="/subnets/view/{{subnet.id}}">{{subnet.subnet}}</a></td>
                      <td>{{subnet.vlans.all()|count}}</td>
                      <td>{{subnet.sites|count}}</td>
                  </tr>
                  {% endfor %}
              {% else %}
                  <tr>
                      <td>N/D</td>
                      <td>N/D</td>
                      <td>N/D</td>
                  </tr>
              {% endif %}
              </tbody>
          </table>
        </div>
    </div>
</div>
{% endblock %}
{% block javascript %}
<script src="{{url_for('static', filename='assests/js/highcharts.js')}}"></script>

<script type="text/javascript">
    $(function () {

        $('#vlans').highcharts({
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: 0,
                plotShadow: false,
                margin: [-60, 0, -100, 0],
                height: 100,
            },
            credits: {
                enabled: false
            },
            title: {
                text: null
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
                pie: {
                    dataLabels: {
                        enabled: true,
                        distance: -35,
                        style: {
                            fontWeight: 'bold',
                            color: 'white',
                            textShadow: '0px 1px 2px black'
                        }
                    },
                    startAngle: -90,
                    endAngle: 90,
                    center: ['50%', '75%']
                }
            },
            series: [{
                type: 'pie',
                name: 'VLAN State',
                innerSize: '50%',
                data: [
                    ['Active', {{vlans.filter_by(isactive=True).all()|count}}],
                    ['Inactive', {{vlans.filter_by(isactive=False).all()|count}}]
                ]
            }]
        });

        $('#subnets').highcharts({
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: 0,
                plotShadow: false,
                margin: [-60, 0, -100, 0],
                height: 100,
            },
            credits: {
                enabled: false
            },
            title: {
                text: null
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
                pie: {
                    dataLabels: {
                        enabled: true,
                        distance: -35,
                        style: {
                            fontWeight: 'bold',
                            color: 'white',
                            textShadow: '0px 1px 2px black'
                        }
                    },
                    startAngle: -90,
                    endAngle: 90,
                    center: ['50%', '75%']
                }
            },
            series: [{
                type: 'pie',
                name: 'Subnet State',
                innerSize: '50%',
                data: [
                    ['Active', {{subnets.filter_by(isactive=True).all()|count}}],
                    ['Inactive', {{subnets.filter_by(isactive=False).all()|count}}]
                ]
            }]
        });
    });
</script>
{% endblock %}